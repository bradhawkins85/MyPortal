<!DOCTYPE html>
<html>
  <%- include('partials/head', { title: 'Admin' }) %>
<body>
  <div class="app-container">
    <%- include('partials/sidebar') %>
    <div class="content">
      <h1>Admin</h1>
      <p><a href="/api-docs">API Docs</a></p>
      <section>
        <h2>Add Company</h2>
        <form action="/admin/company" method="post">
          <input type="text" name="name" placeholder="Company Name" required>
          <button type="submit">Add</button>
        </form>
      </section>
      <section>
        <h2>Add User</h2>
        <form action="/admin/user" method="post">
          <input type="email" name="email" placeholder="Email" required>
          <input type="password" name="password" placeholder="Password" required>
          <select name="companyId">
            <% allCompanies.forEach(function(c) { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% }); %>
          </select>
          <button type="submit">Add User</button>
        </form>
      </section>
      <section>
        <h2>Assign Existing User to Company</h2>
        <form action="/admin/assign" method="post">
          <select name="userId">
            <% users.forEach(function(u) { %>
              <option value="<%= u.id %>"><%= u.email %></option>
            <% }); %>
          </select>
          <select name="companyId">
            <% allCompanies.forEach(function(c) { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% }); %>
          </select>
          <button type="submit">Assign</button>
        </form>
      </section>
      <section>
        <h2>Current Assignments</h2>
        <table>
          <tr><th>User</th><th>Company</th><th>Licenses</th><th>Staff</th><th>Assets</th><th>Invoices</th></tr>
          <% assignments.forEach(function(a) { %>
            <tr>
              <td><%= a.email %></td>
              <td><%= a.company_name %></td>
              <td>
                <form action="/admin/permission" method="post">
                  <input type="hidden" name="userId" value="<%= a.user_id %>">
                  <input type="hidden" name="companyId" value="<%= a.company_id %>">
                  <input type="hidden" name="canManageLicenses" value="0">
                  <input type="checkbox" name="canManageLicenses" value="1" <%= a.can_manage_licenses ? 'checked' : '' %> onchange="this.form.submit()">
                </form>
              </td>
              <td>
                <form action="/admin/permission" method="post">
                  <input type="hidden" name="userId" value="<%= a.user_id %>">
                  <input type="hidden" name="companyId" value="<%= a.company_id %>">
                  <input type="hidden" name="canManageStaff" value="0">
                  <input type="checkbox" name="canManageStaff" value="1" <%= a.can_manage_staff ? 'checked' : '' %> onchange="this.form.submit()">
                </form>
              </td>
              <td>
                <form action="/admin/permission" method="post">
                  <input type="hidden" name="userId" value="<%= a.user_id %>">
                  <input type="hidden" name="companyId" value="<%= a.company_id %>">
                  <input type="hidden" name="canManageAssets" value="0">
                  <input type="checkbox" name="canManageAssets" value="1" <%= a.can_manage_assets ? 'checked' : '' %> onchange="this.form.submit()">
                </form>
              </td>
              <td>
                <form action="/admin/permission" method="post">
                  <input type="hidden" name="userId" value="<%= a.user_id %>">
                  <input type="hidden" name="companyId" value="<%= a.company_id %>">
                  <input type="hidden" name="canManageInvoices" value="0">
                  <input type="checkbox" name="canManageInvoices" value="1" <%= a.can_manage_invoices ? 'checked' : '' %> onchange="this.form.submit()">
                </form>
              </td>
            </tr>
          <% }); %>
        </table>
      </section>
      <section>
        <h2>API Keys</h2>
        <form action="/admin/api-key" method="post">
          <input type="text" name="description" placeholder="Description">
          <input type="date" name="expiryDate">
          <button type="submit">Add API Key</button>
        </form>
        <table>
          <tr><th>Key</th><th>Description</th><th>Expiry</th><th></th></tr>
          <% apiKeys.forEach(function(k) { %>
            <tr>
              <td><%= k.api_key %></td>
              <td><%= k.description %></td>
              <td><%= k.expiry_date || '' %></td>
              <td>
                <form action="/admin/api-key/delete" method="post">
                  <input type="hidden" name="id" value="<%= k.id %>">
                  <button type="submit">Delete</button>
                </form>
              </td>
            </tr>
          <% }); %>
        </table>
      </section>
    </div>
  </div>
</body>
</html>
