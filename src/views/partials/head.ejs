<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/style.css">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.min.css">
  <script type="module">
    import DataTable from 'https://cdn.datatables.net/2.0.0/js/dataTables.min.mjs';

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('table').forEach((table) => {
        if (!table.closest('#cron-generator-container')) {
          new DataTable(table);
        }
      });
    });
  </script>
  <% if (typeof csrfToken !== 'undefined') { %>
    <meta name="csrf-token" content="<%= csrfToken %>">
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const tokenMeta = document.querySelector('meta[name="csrf-token"]');
        const token = tokenMeta?.getAttribute('content');
        if (!token) return;

        document.querySelectorAll('form[method="post"]').forEach((form) => {
          if (!form.querySelector('input[name="_csrf"]')) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = '_csrf';
            input.value = token;
            form.appendChild(input);
          }
        });

        const originalFetch = window.fetch.bind(window);
        window.fetch = (input, init = {}) => {
          init.headers = init.headers || {};
          if (init.headers instanceof Headers) {
            if (!init.headers.has('X-CSRF-Token')) {
              init.headers.set('X-CSRF-Token', token);
            }
          } else if (!('X-CSRF-Token' in init.headers)) {
            init.headers['X-CSRF-Token'] = token;
          }
          if (!init.credentials) {
            init.credentials = 'same-origin';
          }
          return originalFetch(input, init);
        };
      });
    </script>
  <% } %>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const companySwitcher = document.getElementById('company-switcher');
      if (companySwitcher) {
        companySwitcher.addEventListener('change', () => {
          companySwitcher.form?.submit();
        });
      }
    });
  </script>
</head>
