<!DOCTYPE html>
<html>
  <%- include('partials/head', { title: 'Office 365 Connection' }) %>
<body>
  <div class="app-container">
    <%- include('partials/sidebar') %>
    <div class="content">
      <div class="page-header">
        <h1>Office 365 Connection</h1>
        <% if (credential) { %>
          <div class="header-actions">
            <a href="/m365/connect" class="authorize-link">Authorize</a>
            <form method="post" action="/m365/credentials/delete" style="display:inline;">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button type="submit">Disconnect</button>
            </form>
          </div>
        <% } %>
      </div>
      <div class="page-body">
        <% if (!credential) { %>
          <form method="post" action="/m365/credentials">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <label>Tenant ID
              <input type="text" name="tenantId" required>
            </label>
            <label>Client ID
              <input type="text" name="clientId" required>
            </label>
            <label>Client Secret
              <input type="password" name="clientSecret" required>
            </label>
            <button type="submit">Save</button>
          </form>
        <% } else { %>
          <p><strong>Tenant ID:</strong> <%= credential.tenant_id %></p>
          <p><strong>Client ID:</strong> <%= credential.client_id %></p>
          <% if (credential.refresh_token) { %>
            <p>Connected. Token expires at <%= credential.token_expires_at ? new Date(credential.token_expires_at).toLocaleString() : 'unknown' %></p>
          <% } else { %>
            <p>Not authorized with Microsoft 365.</p>
          <% } %>
        <% } %>
      </div>
    </div>
  </div>
</body>
</html>
