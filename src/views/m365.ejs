<!DOCTYPE html>
<html>
  <%- include('partials/head', { title: 'Office 365 Connection' }) %>
<body>
  <div class="app-container">
    <%- include('partials/sidebar') %>
    <div class="content">
      <header class="page-header">
        <div class="page-title">
          <p class="page-subtitle">Modern GMP learning</p>
          <h1>Office 365 Connection</h1>
          <p class="page-description">Manage Microsoft 365 licensing and tenant connectivity.</p>
        </div>
        <div class="header-actions"></div>
      </header>
      <div class="page-body">
      <div class="section-header">
        <% if (credential) { %>
          <div class="header-actions">
            <a href="/m365/connect" class="authorize-link">Authorize</a>
          </div>
        <% } %>
      </div>
      <div class="section-body">
        <% if (error) { %>
          <div class="alert alert-error"><%= error %></div>
        <% } %>
        <% if (!credential) { %>
          <p>No Office 365 credentials configured.</p>
          <% if (typeof isSuperAdmin !== 'undefined' && isSuperAdmin) { %>
            <p><a href="/m365/admin">Manage credentials in the Office 365 admin page.</a></p>
          <% } %>
        <% } else { %>
          <p><strong>Tenant ID:</strong> <%= credential.tenant_id %></p>
          <p><strong>Client ID:</strong> <%= credential.client_id %></p>
          <% if (credential.refresh_token || credential.access_token) { %>
            <p>Connected. Token expires at <%= credential.token_expires_at ? new Date(credential.token_expires_at).toLocaleString() : 'unknown' %></p>
          <% } else { %>
            <p>Not authorized with Microsoft 365.</p>
          <% } %>
        <% } %>
      </div>
    </div>
      </div>
  </div>
</body>
</html>
