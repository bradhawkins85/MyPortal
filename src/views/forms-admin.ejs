<!DOCTYPE html>
<html>
  <%- include('partials/head', { title: 'Forms Admin' }) %>
<body>
  <div class="app-container">
    <%- include('partials/sidebar') %>
    <div class="content">
      <h1>Forms Admin</h1>
      <section class="opnform-banner">
        <h2>Build Forms in OpnForm</h2>
        <p>
          Use the dedicated OpnForm builder to create or edit forms. Any published forms are
          automatically available here for assignment to companies and users.
        </p>
        <div class="opnform-banner-actions">
          <a
            class="button-link"
            href="<%= opnformBaseUrl %>"
            target="_blank"
            rel="noopener noreferrer"
          >
            Open OpnForm
          </a>
          <span class="opnform-banner-note">Opens in a new tab.</span>
        </div>
      </section>
      <section>
        <h2>Add Form</h2>
        <form action="/forms/admin" method="post">
          <input type="text" name="name" placeholder="Name" required>
          <textarea name="embedCode" placeholder="Paste the OpnForm iframe embed code" rows="4" required></textarea>
          <input type="text" name="description" placeholder="Description">
          <button type="submit">Add</button>
        </form>
      </section>
      <section>
        <h2>Edit Forms</h2>
        <table>
          <thead>
            <tr><th>Name</th><th>Embed Code</th><th>Description</th><th>Actions</th></tr>
          </thead>
          <tbody>
            <% forms.forEach(function(f){ %>
              <tr>
                <td><input form="form-<%= f.id %>" type="text" name="name" value="<%= f.name %>" required></td>
                <td><textarea form="form-<%= f.id %>" name="embedCode" rows="4" required><%= (f.embedCodeForDisplay || f.embed_code || '') %></textarea></td>
                <td><input form="form-<%= f.id %>" type="text" name="description" value="<%= f.description %>"></td>
                <td>
                  <form id="form-<%= f.id %>" action="/forms/admin/edit" method="post">
                    <input type="hidden" name="id" value="<%= f.id %>">
                    <button type="submit">Save</button>
                  </form>
                  <form action="/forms/admin/delete" method="post">
                    <input type="hidden" name="id" value="<%= f.id %>">
                    <button type="submit">Delete</button>
                  </form>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </section>
    </div>
  </div>
</body>
</html>
