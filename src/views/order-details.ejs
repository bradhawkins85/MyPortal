<!DOCTYPE html>
<html>
  <%- include('partials/head', { title: 'Order Details' }) %>
  <body>
    <div class="app-container">
      <%- include('partials/sidebar') %>
      <div class="content">
        <h1>Order <%= orderNumber %></h1>
        <p>PO Number: <%= poNumber %></p>
        <p>Status: <%= status %></p>
        <p>Shipping Status: <%= shippingStatus %></p>
        <p>ETA: <%= eta ? eta.toISOString().slice(0,10) : '' %></p>
        <% if (isSuperAdmin) { %><p>Consignment ID: <%= consignmentId || '' %></p><% } %>
        <% if (notes) { %><p>Notes: <%= notes %></p><% } %>
        <% if (isSuperAdmin) { %>
          <form action="/orders/<%= orderNumber %>/shipping" method="post">
            <label>Shipping Status:
              <input type="text" name="shippingStatus" value="<%= shippingStatus %>">
            </label>
            <label>Consignment ID:
              <input type="text" name="consignmentId" value="<%= consignmentId || '' %>">
            </label>
            <label>ETA:
              <input type="date" name="eta" value="<%= eta ? eta.toISOString().slice(0,10) : '' %>">
            </label>
            <button type="submit">Update Shipping</button>
          </form>
        <% } %>
        <label>
          <input type="checkbox" id="smsSubscribe" <%= smsSubscribed ? 'checked' : '' %>> SMS Updates
        </label>
        <% if (items.length === 0) { %>
          <p>No items found.</p>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Image</th>
                <th>Product</th>
                <th>SKU</th>
                <th>Description</th>
                <th>Quantity</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody>
              <% items.forEach(function(item){ %>
                <tr>
                  <td><% if (item.image_url) { %><img src="<%= item.image_url %>" width="50" alt=""><% } %></td>
                  <td><%= item.product_name %></td>
                  <td><%= item.sku %></td>
                  <td><%- item.description.replace(/\n/g, '<br>') %></td>
                  <td><%= item.quantity %></td>
                  <td>$<%= item.price.toFixed(2) %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
        <script>
          document.getElementById('smsSubscribe').addEventListener('change', async function() {
            await fetch(`/orders/<%= orderNumber %>/sms`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ subscribe: this.checked })
            });
          });
        </script>
      </div>
    </div>
  </body>
</html>
