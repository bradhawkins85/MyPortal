<!DOCTYPE html>
<html>
  <%- include('partials/head', { title: 'Invoices' }) %>
<body>
  <div class="app-container">
    <%- include('partials/sidebar') %>
    <div class="content">
      <h1>Invoices</h1>
      <section>
        <h2>Company Invoices</h2>
        <table>
          <thead>
            <tr><th>Number</th><th>Amount</th><th>Due Date</th><th>Status</th><% if (isSuperAdmin) { %><th>Actions</th><% } %></tr>
          </thead>
          <tbody>
          <% invoices.forEach(function(i) { %>
            <tr>
              <td><%= i.invoice_number %></td>
              <td><%= i.amount %></td>
              <td><%= i.due_date %></td>
              <td><%= i.status %></td>
              <% if (isSuperAdmin) { %>
              <td><button class="delete-btn" data-invoice-id="<%= i.id %>">Delete</button></td>
              <% } %>
            </tr>
          <% }); %>
          </tbody>
        </table>
      </section>
    </div>
  </div>
<% if (isSuperAdmin) { %>
<script>
  document.querySelectorAll('.delete-btn').forEach(function(btn) {
    btn.addEventListener('click', async function() {
      if (!confirm('Delete invoice?')) return;
      const res = await fetch(`/invoices/${this.dataset.invoiceId}`, { method: 'DELETE' });
      if (res.ok) {
        location.reload();
      } else {
        alert('Failed to delete invoice');
      }
    });
  });
</script>
<% } %>
</body>
</html>
