{% extends "base.html" %}

{% set scope_labels = {
  "anonymous": "Public",
  "user": "Specific users",
  "company": "Company members",
  "company_admin": "Company admins",
  "super_admin": "Super admins"
} %}

{% block header_actions %}
  <a class="button" href="/admin/knowledge-base/new">
    <span class="button__icon" aria-hidden="true">
      <svg viewBox="0 0 24 24" focusable="false"><path d="M12 2a4 4 0 0 1 4 4v2h1.5a2.5 2.5 0 0 1 0 5H16v1h1.5a2.5 2.5 0 0 1 0 5H16v1a4 4 0 0 1-8 0v-1H6.5a2.5 2.5 0 0 1 0-5H8v-1H6.5a2.5 2.5 0 0 1 0-5H8V6a4 4 0 0 1 4-4zm-1 6V6a1 1 0 0 1 2 0v2h2a1 1 0 0 1 0 2h-2v3h2a1 1 0 0 1 0 2h-2v2a1 1 0 0 1-2 0v-2H9a1 1 0 0 1 0-2h2V8H9a1 1 0 0 1 0-2z"/></svg>
    </span>
    <span class="button__label">New article</span>
  </a>
{% endblock %}

{% block content %}
<div class="kb-admin">
  <section class="card card--panel kb-admin__panel">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Knowledge base catalogue</h2>
        <p class="card__subtitle">Review published and draft articles, filter entries, and open one in a dedicated editor.</p>
      </div>
      <div class="card__controls">
        <input
          type="search"
          class="form-input"
          placeholder="Filter articles"
          aria-label="Filter articles"
          data-table-filter="kb-admin-table"
        />
      </div>
    </header>
    <div class="table-wrapper table-wrapper--short">
      <table class="table table--compact" id="kb-admin-table" data-table>
        <thead>
          <tr>
            <th scope="col" data-sort="string">Title</th>
            <th scope="col" data-sort="string">Scope</th>
            <th scope="col" data-sort="string">Status</th>
            <th scope="col" data-sort="date">Updated</th>
          </tr>
        </thead>
        <tbody>
          {% for article in kb_articles %}
          <tr
            data-kb-row
            data-kb-article-id="{{ article.id }}"
            data-kb-article-slug="{{ article.slug }}"
            data-kb-permission-scope="{{ article.permission_scope }}"
            data-kb-is-published="{{ 'true' if article.is_published else 'false' }}"
            data-kb-updated="{{ article.updated_at_iso or '' }}"
          >
            <td data-label="Title">
              <a class="kb-admin__link" href="/admin/knowledge-base/articles/{{ article.slug }}">
                <span class="kb-admin__title">{{ article.title }}</span>
                {% if article.summary %}
                  <span class="kb-admin__summary">{{ article.summary }}</span>
                {% endif %}
              </a>
            </td>
            <td data-label="Scope" data-value="{{ article.permission_scope }}">
              <span class="tag">{{ scope_labels.get(article.permission_scope, article.permission_scope|title) }}</span>
            </td>
            <td data-label="Status" data-value="{{ 'Published' if article.is_published else 'Draft' }}">
              {% if article.is_published %}
                <span class="status status--success">Published</span>
              {% else %}
                <span class="status status--warning">Draft</span>
              {% endif %}
            </td>
            <td data-label="Updated" data-value="{{ article.updated_at_iso or '' }}">
              <span data-utc="{{ article.updated_at_iso or '' }}">{{ article.updated_at_iso or 'â€”' }}</span>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" class="table__empty">No knowledge base articles are available yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/tables.js" defer></script>
{% endblock %}
