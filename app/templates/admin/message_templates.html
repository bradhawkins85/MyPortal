{% extends "base.html" %}

{% block header_title %}
  <div class="header__title-content header__title-content--spread">
    <span class="header__title-text">Message templates</span>
    <a class="button button--primary button--small header__title-button" href="/admin/message-templates/new">
      New template
    </a>
  </div>
{% endblock %}

{% block content %}
  <div class="admin-grid">
    <section class="card card--panel" aria-labelledby="message-templates-heading">
      <header class="card__header card__header--actions">
        <div>
          <h2 class="card__title" id="message-templates-heading">Message templates</h2>
          <p class="card__subtitle">
            Maintain reusable email and notification bodies for automations, integrations, and bulk messaging.
          </p>
        </div>
        <form method="get" class="card__controls card__controls--compact" aria-label="Filter message templates">
          <input type="search" class="form-input" name="search" value="{{ filters.search or '' }}" placeholder="Search templates" aria-label="Search templates" />
          <label class="visually-hidden" for="content-type-filter">Content type</label>
          <select id="content-type-filter" class="form-input" name="content_type">
            <option value="">All content types</option>
            {% for option in content_type_options %}
              <option value="{{ option.value }}" {% if option.value == filters.content_type %}selected{% endif %}>{{ option.label }}</option>
            {% endfor %}
          </select>
          <button type="submit" class="button">Apply</button>
        </form>
      </header>
      <div class="table-wrapper">
        <table class="table" id="message-templates-table" data-table>
          <thead>
            <tr>
              <th scope="col" data-sort="string">Slug</th>
              <th scope="col" data-sort="string">Name</th>
              <th scope="col" data-sort="string">Description</th>
              <th scope="col" data-sort="string">Content type</th>
              <th scope="col" data-sort="date">Updated</th>
              <th scope="col" class="table__actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for template in templates %}
              <tr
                data-template-id="{{ template.id }}"
                data-template-json="message-template-{{ template.id }}-data"
              >
                <td data-label="Slug">{{ template.slug }}</td>
                <td data-label="Name">{{ template.name }}</td>
                <td data-label="Description">{{ template.description or '—' }}</td>
                <td data-label="Content type">{{ template.content_type }}</td>
                <td data-label="Updated" data-value="{{ template.updated_at_iso or '' }}">
                  {% if template.updated_at_iso %}
                    <span data-utc="{{ template.updated_at_iso }}"></span>
                  {% else %}
                    <span class="text-muted">—</span>
                  {% endif %}
                </td>
                <td class="table__actions">
                  <div class="table__action-buttons">
                    <a class="button button--ghost" href="/admin/message-templates/{{ template.id }}/edit">Edit</a>
                    <button type="button" class="button button--danger" data-template-delete>Delete</button>
                  </div>
                </td>
              </tr>
              <script type="application/json" id="message-template-{{ template.id }}-data" hidden>
                {{ {
                  "id": template.id,
                  "slug": template.slug,
                  "name": template.name,
                  "description": template.description,
                  "content_type": template.content_type,
                  "content": template.content
                } | tojson }}
              </script>
            {% else %}
              <tr>
                <td colspan="6" class="table__empty">No message templates have been created yet.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/tables.js" defer></script>
  <script src="/static/js/admin.js" defer></script>
{% endblock %}
