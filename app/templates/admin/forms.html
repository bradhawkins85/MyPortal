{% extends "base.html" %}

{% block content %}
<div class="admin-grid">
  <section class="card card--panel">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Build with OpnForm</h2>
        <p class="card__subtitle">Design forms in OpnForm and surface them instantly within the customer portal.</p>
      </div>
      {% if opnform_base_url %}
        <a class="button" href="{{ opnform_base_url }}" target="_blank" rel="noopener">Open OpnForm</a>
      {% endif %}
    </header>
    <p class="text-muted">Published forms appear automatically and can be assigned to users or companies from here.</p>
  </section>

  <section class="card card--panel">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Add a form</h2>
        <p class="card__subtitle">Store the OpnForm share URL with a friendly label and optional description.</p>
      </div>
    </header>
    <form action="/myforms/admin" method="post" class="form-grid">
      {% include "partials/csrf.html" %}
      <div class="form-field">
        <label class="form-label" for="new-form-name">Name</label>
        <input class="form-input" id="new-form-name" name="name" required />
      </div>
      <div class="form-field">
        <label class="form-label" for="new-form-url">Form URL</label>
        <input class="form-input" id="new-form-url" name="url" type="url" placeholder="https://forms.example.com/" required />
      </div>
      <div class="form-field form-field--wide">
        <label class="form-label" for="new-form-description">Description</label>
        <input class="form-input" id="new-form-description" name="description" />
      </div>
      <div class="form-actions">
        <button type="submit" class="button">Save form</button>
      </div>
    </form>
  </section>

  <section class="card card--panel">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Manage existing forms</h2>
        <p class="card__subtitle">Update URLs or descriptions inline and archive forms you no longer need.</p>
      </div>
      <div class="card__controls">
        <input
          type="search"
          class="form-input"
          placeholder="Filter forms"
          aria-label="Filter forms"
          data-table-filter="forms-admin-table"
        />
      </div>
    </header>
    <div class="table-wrapper">
      <table class="table" id="forms-admin-table" data-table>
        <thead>
          <tr>
            <th scope="col" data-sort="string">Name</th>
            <th scope="col" data-sort="string">URL</th>
            <th scope="col" data-sort="string">Description</th>
            <th scope="col" class="table__actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for form in forms %}
            <tr>
              <td data-label="Name">
                <input form="form-{{ form.id }}" class="form-input form-input--inline" type="text" name="name" value="{{ form.name }}" required />
              </td>
              <td data-label="URL">
                <input form="form-{{ form.id }}" class="form-input form-input--inline" type="url" name="url" value="{{ form.url }}" required />
              </td>
              <td data-label="Description">
                <input form="form-{{ form.id }}" class="form-input form-input--inline" type="text" name="description" value="{{ form.description or '' }}" />
              </td>
              <td class="table__actions">
                <div class="table__action-buttons">
                  <form id="form-{{ form.id }}" action="/myforms/admin/edit" method="post" class="inline-form">
                    {% include "partials/csrf.html" %}
                    <input type="hidden" name="id" value="{{ form.id }}" />
                    <button type="submit" class="button button--ghost">Save</button>
                  </form>
                  <form action="/myforms/admin/delete" method="post" class="inline-form" data-confirm="Delete this form?">
                    {% include "partials/csrf.html" %}
                    <input type="hidden" name="id" value="{{ form.id }}" />
                    <button type="submit" class="button button--danger">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="4" class="table__empty">No forms have been added yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/tables.js" defer></script>
  <script src="/static/js/forms_admin.js" defer></script>
{% endblock %}
