{% extends "base.html" %}

{% block content %}
<div class="admin-grid">
  <section class="card card--panel">
    <header class="card__header">
      <div>
        <h2 class="card__title">Defined roles</h2>
        <p class="card__subtitle">Manage reusable permission sets for company memberships.</p>
      </div>
      <input
        type="search"
        class="form-input"
        placeholder="Filter roles"
        aria-label="Filter roles"
        data-table-filter="roles-table"
      />
    </header>
    <div class="table-wrapper">
      <table class="table" id="roles-table" data-table>
        <thead>
          <tr>
            <th scope="col" data-sort="string">Name</th>
            <th scope="col" data-sort="string">Description</th>
            <th scope="col" data-sort="string">Permissions</th>
            <th scope="col" data-sort="string">System</th>
            <th scope="col" class="table__actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for role in roles %}
            <tr
              data-role-id="{{ role.id }}"
              data-role-name="{{ role.name }}"
              data-role-description="{{ role.description or '' }}"
              data-role-permissions='{{ role.permissions | tojson }}'
              data-role-system="{{ 'true' if role.is_system else 'false' }}"
            >
              <td data-label="Name">{{ role.name }}</td>
              <td data-label="Description">{{ role.description or 'â€”' }}</td>
              <td data-label="Permissions">
                {% if role.permissions %}
                  <span class="tag-list">
                    {% for perm in role.permissions %}
                      <span class="tag">{{ perm }}</span>
                    {% endfor %}
                  </span>
                {% else %}
                  <span class="text-muted">None</span>
                {% endif %}
              </td>
              <td data-label="System">{{ 'Yes' if role.is_system else 'No' }}</td>
              <td class="table__actions">
                <div class="table__action-buttons">
                  <button type="button" class="button button--ghost" data-role-edit>Edit</button>
                  {% if not role.is_system %}
                    <button type="button" class="button button--danger" data-role-delete>Delete</button>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="5" class="table__empty">No roles have been defined yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card card--panel">
    <header class="card__header">
      <div>
        <h2 class="card__title">Create or update a role</h2>
        <p class="card__subtitle">Editing a role updates permissions for every assigned member immediately.</p>
      </div>
    </header>
    <form id="role-form" class="form" autocomplete="off">
      <input type="hidden" name="role_id" id="role-id" />
      <div class="form-field">
        <label class="form-label" for="role-name">Role name</label>
        <input class="form-input" id="role-name" name="name" required minlength="2" maxlength="100" />
      </div>
      <div class="form-field">
        <label class="form-label" for="role-description">Description</label>
        <textarea class="form-input form-input--textarea" id="role-description" name="description" rows="3"></textarea>
      </div>
      <div class="form-field">
        <label class="form-label">Permissions</label>
        <div class="form-checkboxes" id="role-permissions-group" role="group" aria-describedby="role-permissions-help">
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="company.manage" data-permission-checkbox />
            <span>Company Management</span>
            <span class="form-help">Configure company profiles, contact details, and operational settings</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="membership.manage" data-permission-checkbox />
            <span>Membership Management</span>
            <span class="form-help">Invite, approve, suspend, or reassign company members</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="billing.manage" data-permission-checkbox />
            <span>Billing Management</span>
            <span class="form-help">Access subscription, invoicing, and payment methods</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="audit.view" data-permission-checkbox />
            <span>Audit View</span>
            <span class="form-help">Read-only visibility into security and activity audit trails</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="portal.access" data-permission-checkbox />
            <span>Portal Access</span>
            <span class="form-help">Sign in and use the general portal experience</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="helpdesk.technician" data-permission-checkbox />
            <span>Helpdesk Technician</span>
            <span class="form-help">Access the global ticketing workspace to triage, assign, and update tickets</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="licenses.manage" data-permission-checkbox />
            <span>Manage Licenses</span>
            <span class="form-help">Manage company licenses and subscriptions</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="licenses.order" data-permission-checkbox />
            <span>Order Licenses</span>
            <span class="form-help">Place orders for new licenses</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="staff.manage" data-permission-checkbox />
            <span>Manage Staff</span>
            <span class="form-help">Manage company staff members</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="shop.access" data-permission-checkbox />
            <span>Shop Access</span>
            <span class="form-help">Access the company shop</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="cart.access" data-permission-checkbox />
            <span>Cart Access</span>
            <span class="form-help">Access and manage shopping cart</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="orders.access" data-permission-checkbox />
            <span>Orders Access</span>
            <span class="form-help">View and manage company orders</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="forms.access" data-permission-checkbox />
            <span>Forms Access</span>
            <span class="form-help">Access and submit company forms</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="assets.manage" data-permission-checkbox />
            <span>Manage Assets</span>
            <span class="form-help">Manage company assets and inventory</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="invoices.manage" data-permission-checkbox />
            <span>Manage Invoices</span>
            <span class="form-help">View and manage company invoices</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="office_groups.manage" data-permission-checkbox />
            <span>Manage Office Groups</span>
            <span class="form-help">Manage company office groups and locations</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="issues.manage" data-permission-checkbox />
            <span>Manage Issues</span>
            <span class="form-help">Manage company issues and support tickets</span>
          </label>
          <label class="form-checkbox">
            <input type="checkbox" name="permission" value="company.admin" data-permission-checkbox />
            <span>Company Administrator</span>
            <span class="form-help">Full administrative access to company resources</span>
          </label>
        </div>
        <p class="form-help" id="role-permissions-help">Select the permissions to assign to this role.</p>
      </div>
      <div class="form-actions">
        <button type="submit" class="button">Save role</button>
        <button type="button" class="button button--ghost" data-role-reset>Clear form</button>
      </div>
      <p class="form-hint">System roles cannot be deleted and their names are fixed to retain portal integrity.</p>
    </form>
  </section>

  <details class="card card--panel card-collapsible" data-roles-admin-menu>
    <summary class="card__header card__header--collapsible">
      <div>
        <h2 class="card__title">Roles administration menu</h2>
        <p class="card__subtitle">Understand how the administration menu supports secure, least-privilege access control.</p>
      </div>
      <span class="card__toggle-icon" aria-hidden="true"></span>
    </summary>
    <div class="card-collapsible__content">
      <div class="card__body card__body--stacked">
      <p>
        The Roles administration menu is the central hub for defining reusable permission sets that can be applied to any
        company membership. Super administrators can review every existing role in the table above, inspect its granted
        permissions, and revoke obsolete definitions while retaining system-protected defaults that safeguard mandatory
        access policies.
      </p>
      <p>
        When you open the menu from the navigation sidebar, two panels are always available: the catalogue of existing
        roles and the management form for updates. Use the search filter to quickly locate a role, select <strong>Edit</strong>
        to populate the form, and provide a comma-separated list of permission keys when creating or refining roles. All
        changes take effect immediately across the portal to keep member privileges aligned with the latest security
        requirements.
      </p>
      <p>
        System roles are identified in the table and are intentionally immutable to preserve baseline security for
        critical workflows. Custom roles, however, can be updated or deleted as your governance model evolves. Regularly
        review the menu to confirm roles still match business needs, and document significant adjustments in your
        compliance records.
      </p>
      <h3>Assignable permissions</h3>
      <p>
        Roles can draw from the following permission catalogue. Combine only the capabilities required for each persona to
        maintain least-privilege access.
      </p>
      <dl class="definition-list">
        <div class="definition-list__item">
          <dt><code>company.manage</code></dt>
          <dd>Grant authority to configure company profiles, contact details, and operational settings.</dd>
        </div>
        <div class="definition-list__item">
          <dt><code>membership.manage</code></dt>
          <dd>Allow administrators to invite, approve, suspend, or reassign company members.</dd>
        </div>
        <div class="definition-list__item">
          <dt><code>billing.manage</code></dt>
          <dd>Enable access to subscription, invoicing, and payment method management workflows.</dd>
        </div>
        <div class="definition-list__item">
          <dt><code>audit.view</code></dt>
          <dd>Provide read-only visibility into security and activity audit trails.</dd>
        </div>
        <div class="definition-list__item">
          <dt><code>portal.access</code></dt>
          <dd>Permit authenticated users to sign in and use the general portal experience.</dd>
        </div>
        <div class="definition-list__item">
          <dt><code>helpdesk.technician</code></dt>
          <dd>Grant designated staff access to the global ticketing workspace so they can triage, assign, and update tickets without broader administrative privileges.</dd>
        </div>
      </dl>
      <p class="text-muted">New permissions will be documented here as they become available.</p>
      </div>
    </div>
  </details>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/tables.js" defer></script>
  <script src="/static/js/admin.js" defer></script>
{% endblock %}
