{% extends "bcp/layout.html" %}

{% block bcp_content %}
<div class="bcp-page page-container">
  <section class="card">
    <div class="card-header">
      <div>
        <h2 class="card-title">Export Business Continuity Plan</h2>
        <p class="text-muted text-sm">Generate a PDF report that mirrors the official Business Queensland template.</p>
      </div>
      <a href="/bcp" class="btn btn-secondary">Back to Overview</a>
    </div>
    <div class="card-body export-layout">
      <div class="export-summary">
        <h3 class="section-heading">Plan Summary</h3>
        <dl class="summary-grid">
          <div>
            <dt>Plan title</dt>
            <dd>{{ plan.title }}</dd>
          </div>
          <div>
            <dt>Version</dt>
            <dd>{{ plan.version or 'Not set' }}</dd>
          </div>
          <div>
            <dt>Last reviewed</dt>
            <dd>{{ plan.last_reviewed.strftime('%Y-%m-%d') if plan.last_reviewed else 'Not reviewed yet' }}</dd>
          </div>
          <div>
            <dt>Next review</dt>
            <dd>{{ plan.next_review.strftime('%Y-%m-%d') if plan.next_review else 'Not scheduled' }}</dd>
          </div>
        </dl>
        <p class="text-muted">
          The PDF includes plan overview, risk management, BIA, incident response, recovery and rehearse/maintain sections,
          matching the template order with automated tables and contact details.
        </p>
      </div>
      <form class="export-form" method="get" action="/bcp/export/pdf">
        <h3 class="section-heading">Download PDF Report</h3>
        <div class="form-group">
          <label class="form-label" for="event_log_limit">Event log entries</label>
          <input
            class="form-input"
            type="number"
            id="event_log_limit"
            name="event_log_limit"
            min="1"
            max="{{ max_event_log_limit }}"
            value="{{ default_event_log_limit }}"
            required
          >
          <p class="form-hint">Choose how many recent incident log entries to include (maximum {{ max_event_log_limit }}).</p>
        </div>
        <button type="submit" class="btn btn-primary export-download-button">Download PDF</button>
        <p class="attribution">Adapted from the Business Queensland Business continuity plan â€“ Template (CC BY 4.0)</p>
      </form>
    </div>
  </section>

  {% if export_links %}
  <section class="card">
    <div class="card-header">
      <h3 class="card-title">Other export formats</h3>
      <p class="text-muted text-sm">Supplement the PDF with CSV extracts for deeper analysis.</p>
    </div>
    <div class="card-body">
      <div class="export-options-grid">
        {% for option in export_links %}
        <div class="export-option">
          <h4>{{ option.title }}</h4>
          <p>{{ option.description }}</p>
          <a class="btn btn-light" href="{{ option.href }}">Download</a>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}
</div>
{% endblock %}
