{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="/static/css/bcp.css">
{% endblock %}

{% block content %}
<div class="page-container">
  <!-- Success/Error Messages -->
  {% if request.query_params.get('success') %}
    <div class="alert alert-success">{{ request.query_params.get('success') }}</div>
  {% endif %}
  {% if request.query_params.get('error') %}
    <div class="alert alert-error">{{ request.query_params.get('error') }}</div>
  {% endif %}

  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">{{ 'Edit' if activity else 'Add' }} Critical Activity</h1>
      <p class="page-description">Document critical business activities and their impact</p>
    </div>
    <div class="page-actions">
      <a href="/bcp/bia" class="btn btn-secondary">Back to BIA</a>
    </div>
  </div>

  <!-- Edit Form -->
  <section class="card">
    <div class="card-header">
      <h2 class="card-title">Activity Details</h2>
    </div>
    <div class="card-body">
      <form method="post" action="{{ '/bcp/bia/' + (activity.id|string) + '/update' if activity else '/bcp/bia' }}">
        <input type="hidden" name="_csrf" value="{{ csrf_token }}">
        
        <!-- Basic Information -->
        <div class="form-section">
          <h3 class="form-section-title">Basic Information</h3>
          
          <div class="form-group">
            <label for="name" class="form-label required">Activity Name</label>
            <input
              type="text"
              id="name"
              name="name" 
              class="form-input" 
              value="{{ activity.name if activity else '' }}" 
              placeholder="e.g., Email Services, Payroll Processing" 
              required
            >
          </div>

          <div class="form-group">
            <label for="description" class="form-label">Description</label>
            <textarea 
              id="description" 
              name="description" 
              class="form-input" 
              rows="3" 
              placeholder="Brief description of this critical activity"
            >{{ activity.description if activity else '' }}</textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="priority" class="form-label">Priority</label>
              <select id="priority" name="priority" class="form-input">
                <option value="">Select priority...</option>
                <option value="High" {% if activity and activity.priority == 'High' %}selected{% endif %}>High</option>
                <option value="Medium" {% if activity and activity.priority == 'Medium' %}selected{% endif %}>Medium</option>
                <option value="Low" {% if activity and activity.priority == 'Low' %}selected{% endif %}>Low</option>
              </select>
            </div>

            <div class="form-group">
              <label for="importance" class="form-label">Importance Rating (1-5)</label>
              <input 
                type="number" 
                id="importance" 
                name="importance" 
                class="form-input" 
                min="1" 
                max="5" 
                value="{{ activity.importance if activity and activity.importance else '' }}"
                placeholder="1 = most important, 5 = least important"
              >
              <small class="form-hint">Rate 1-5, where 1 is most important</small>
            </div>
          </div>

          <div class="form-group">
            <label for="supplier_dependency" class="form-label">Dependency on Outside Supply</label>
            <select id="supplier_dependency" name="supplier_dependency" class="form-input">
              <option value="">Select dependency level...</option>
              <option value="None" {% if activity and activity.supplier_dependency == 'None' %}selected{% endif %}>None</option>
              <option value="Sole" {% if activity and activity.supplier_dependency == 'Sole' %}selected{% endif %}>Sole (single supplier)</option>
              <option value="Major" {% if activity and activity.supplier_dependency == 'Major' %}selected{% endif %}>Major (few suppliers)</option>
              <option value="Many" {% if activity and activity.supplier_dependency == 'Many' %}selected{% endif %}>Many alternatives</option>
            </select>
          </div>

          <div class="form-group">
            <label for="notes" class="form-label">Additional Notes</label>
            <textarea 
              id="notes" 
              name="notes" 
              class="form-input" 
              rows="3" 
              placeholder="Any additional notes about this activity"
            >{{ activity.notes if activity else '' }}</textarea>
          </div>
        </div>

        <!-- Impact Assessment -->
        <div class="form-section">
          <h3 class="form-section-title">Impact Assessment</h3>
          <p class="form-section-description">Document the potential losses if this activity becomes unavailable</p>

          <div class="form-group">
            <label for="rto_hours" class="form-label">Recovery Time Objective (RTO)</label>
            <input 
              type="number" 
              id="rto_hours" 
              name="rto_hours" 
              class="form-input" 
              min="0" 
              value="{{ activity.impact.rto_hours if activity and activity.impact and activity.impact.rto_hours is not none else '' }}"
              placeholder="Maximum acceptable downtime in hours"
            >
            <small class="form-hint">Enter hours (e.g., 24 for 1 day, 168 for 1 week)</small>
          </div>

          <div class="form-group">
            <label for="losses_financial" class="form-label">Financial Impact (Revenue Loss)</label>
            <textarea 
              id="losses_financial" 
              name="losses_financial" 
              class="form-input" 
              rows="2" 
              placeholder="Describe potential revenue loss if this activity is unavailable"
            >{{ activity.impact.losses_financial if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="losses_increased_costs" class="form-label">Increased Costs</label>
            <textarea 
              id="losses_increased_costs" 
              name="losses_increased_costs" 
              class="form-input" 
              rows="2" 
              placeholder="Additional costs incurred during disruption"
            >{{ activity.impact.losses_increased_costs if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="losses_staffing" class="form-label">Staffing Impact</label>
            <textarea 
              id="losses_staffing" 
              name="losses_staffing" 
              class="form-input" 
              rows="2" 
              placeholder="Impact on staff productivity, workload, or availability"
            >{{ activity.impact.losses_staffing if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="losses_product_service" class="form-label">Product/Service Delivery Impact</label>
            <textarea 
              id="losses_product_service" 
              name="losses_product_service" 
              class="form-input" 
              rows="2" 
              placeholder="Impact on ability to deliver products or services"
            >{{ activity.impact.losses_product_service if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="losses_reputation" class="form-label">Reputation & Goodwill Impact</label>
            <textarea 
              id="losses_reputation" 
              name="losses_reputation" 
              class="form-input" 
              rows="2" 
              placeholder="Impact on reputation, customer satisfaction, brand value"
            >{{ activity.impact.losses_reputation if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="fines" class="form-label">Fines & Penalties</label>
            <textarea 
              id="fines" 
              name="fines" 
              class="form-input" 
              rows="2" 
              placeholder="Potential regulatory fines, contractual penalties"
            >{{ activity.impact.fines if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="legal_liability" class="form-label">Legal Liability / Public Harm</label>
            <textarea 
              id="legal_liability" 
              name="legal_liability" 
              class="form-input" 
              rows="2" 
              placeholder="Potential legal liability or public safety concerns"
            >{{ activity.impact.legal_liability if activity and activity.impact else '' }}</textarea>
          </div>

          <div class="form-group">
            <label for="losses_comments" class="form-label">Additional Impact Comments</label>
            <textarea 
              id="losses_comments" 
              name="losses_comments" 
              class="form-input" 
              rows="3" 
              placeholder="Any additional comments about impacts"
            >{{ activity.impact.losses_comments if activity and activity.impact else '' }}</textarea>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <a href="/bcp/bia" class="btn btn-secondary">Cancel</a>
          <button type="submit" class="btn btn-primary">
            {{ 'Update Activity' if activity else 'Create Activity' }}
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
{% endblock %}
