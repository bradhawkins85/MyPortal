{% extends "base.html" %}

{% block content %}
<div class="bc-help">
  <div class="card card--panel">
    <header class="card__header">
      <h1 class="card__title">Business Continuity Help & Documentation</h1>
      <p class="card__subtitle">Comprehensive guide to understanding and using the Business Continuity system</p>
    </header>
    
    <div class="card__body">
      <!-- Table of Contents -->
      <nav class="bc-help__toc">
        <h2 class="bc-help__section-title">Table of Contents</h2>
        <ul class="bc-help__toc-list">
          <li><a href="#overview">Overview</a></li>
          <li><a href="#concepts">Key Concepts</a></li>
          <li><a href="#roles">User Roles & Permissions</a></li>
          <li><a href="#workflows">Workflows</a></li>
          <li><a href="#admin-guide">Administrator Guide</a></li>
          <li><a href="#export">Exporting Plans</a></li>
        </ul>
      </nav>

      <!-- Overview Section -->
      <section id="overview" class="bc-help__section">
        <h2 class="bc-help__section-title">Overview</h2>
        <p>The Business Continuity (BC) system provides comprehensive tools for creating, managing, and maintaining business continuity plans including Disaster Recovery (DR), Incident Response (IR), and Business Continuity Planning (BCP).</p>
        
        <h3 class="bc-help__subsection-title">Plan Types</h3>
        <ul class="bc-help__list">
          <li><strong>Disaster Recovery:</strong> Plans for recovering from catastrophic failures, natural disasters, or major system outages</li>
          <li><strong>Incident Response:</strong> Plans for responding to security incidents, breaches, or cyber attacks</li>
          <li><strong>Business Continuity:</strong> Plans for maintaining business operations during disruptions and ensuring organizational resilience</li>
        </ul>
      </section>

      <!-- Key Concepts Section -->
      <section id="concepts" class="bc-help__section">
        <h2 class="bc-help__section-title">Key Concepts</h2>
        
        <h3 class="bc-help__subsection-title">Templates</h3>
        <p>Templates define the structure and sections of BC plans. The system includes a default government-standard BCP template with comprehensive sections covering all aspects of business continuity planning.</p>
        
        <h3 class="bc-help__subsection-title">Plans</h3>
        <p>Plans are instances created from templates. Each plan has its own lifecycle, version history, and access controls.</p>
        
        <h3 class="bc-help__subsection-title">Versions</h3>
        <p>Plans support versioning to track changes over time. Each version includes:</p>
        <ul class="bc-help__list">
          <li>Version number (automatically incremented)</li>
          <li>Author information</li>
          <li>Change summary</li>
          <li>Complete content snapshot</li>
          <li>Activation status</li>
        </ul>
        
        <h3 class="bc-help__subsection-title">Plan Status</h3>
        <ul class="bc-help__list">
          <li><strong>Draft:</strong> Plan is being created or edited</li>
          <li><strong>In Review:</strong> Plan has been submitted for approval</li>
          <li><strong>Approved:</strong> Plan has been reviewed and approved for use</li>
          <li><strong>Archived:</strong> Plan is no longer active but retained for records</li>
        </ul>
      </section>

      <!-- Roles Section -->
      <section id="roles" class="bc-help__section">
        <h2 class="bc-help__section-title">User Roles & Permissions</h2>
        <p>The BC system uses Role-Based Access Control (RBAC) with four distinct roles:</p>
        
        <div class="bc-help__roles">
          <div class="bc-help__role-card">
            <h3 class="bc-help__role-title">Viewer</h3>
            <p class="bc-help__role-description">Read-only access to approved plans</p>
            <ul class="bc-help__role-permissions">
              <li>View approved plans</li>
              <li>View plan versions</li>
              <li>Acknowledge plans</li>
              <li>Export approved plans</li>
            </ul>
          </div>
          
          <div class="bc-help__role-card">
            <h3 class="bc-help__role-title">Editor</h3>
            <p class="bc-help__role-description">Create and edit plans</p>
            <ul class="bc-help__role-permissions">
              <li>All Viewer permissions</li>
              <li>Create new plans</li>
              <li>Edit draft plans</li>
              <li>Create new versions</li>
              <li>Upload attachments</li>
              <li>Submit plans for review</li>
            </ul>
          </div>
          
          <div class="bc-help__role-card">
            <h3 class="bc-help__role-title">Approver</h3>
            <p class="bc-help__role-description">Review and approve plans</p>
            <ul class="bc-help__role-permissions">
              <li>All Editor permissions</li>
              <li>Review submitted plans</li>
              <li>Approve or request changes</li>
              <li>Activate plan versions</li>
            </ul>
          </div>
          
          <div class="bc-help__role-card">
            <h3 class="bc-help__role-title">Admin</h3>
            <p class="bc-help__role-description">Full system administration</p>
            <ul class="bc-help__role-permissions">
              <li>All Approver permissions</li>
              <li>Manage templates</li>
              <li>Delete plans</li>
              <li>View all audit trails</li>
              <li>Manage user roles</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Workflows Section -->
      <section id="workflows" class="bc-help__section">
        <h2 class="bc-help__section-title">Workflows</h2>
        
        <h3 class="bc-help__subsection-title">Creating a Plan</h3>
        <ol class="bc-help__steps">
          <li>Navigate to Business Continuity → Plans</li>
          <li>Click "New Plan"</li>
          <li>Select a plan type (DR, IR, or BC)</li>
          <li>Choose a template (or use the default)</li>
          <li>Enter plan title and initial content</li>
          <li>Click "Create" to save as draft</li>
        </ol>
        
        <h3 class="bc-help__subsection-title">Review & Approval Process</h3>
        <ol class="bc-help__steps">
          <li><strong>Submit for Review:</strong> Editor submits draft plan and selects reviewers</li>
          <li><strong>Review:</strong> Assigned approvers review the plan content</li>
          <li><strong>Decision:</strong> Approvers can either:
            <ul>
              <li>Approve the plan (status changes to "Approved" when all reviewers approve)</li>
              <li>Request changes (status changes back to "Draft" for revisions)</li>
            </ul>
          </li>
          <li><strong>Activation:</strong> Once approved, plan version can be activated for use</li>
        </ol>
        
        <h3 class="bc-help__subsection-title">Version Management</h3>
        <ol class="bc-help__steps">
          <li>Open an existing plan</li>
          <li>Click "New Version" to create a new version</li>
          <li>Make your changes to the plan content</li>
          <li>Enter a summary of changes made</li>
          <li>Save the version</li>
          <li>Submit for review if required</li>
          <li>Once approved, activate the version to make it current</li>
        </ol>
        
        <h3 class="bc-help__subsection-title">Acknowledgment Workflow</h3>
        <p>When a new version is activated, users with BC access are prompted to acknowledge they've read and understood the updated plan:</p>
        <ol class="bc-help__steps">
          <li>User logs in and sees acknowledgment prompt</li>
          <li>User reviews the plan content</li>
          <li>User clicks "Acknowledge" to confirm</li>
          <li>Acknowledgment is recorded in audit trail</li>
        </ol>
      </section>

      <!-- Administrator Guide Section -->
      <section id="admin-guide" class="bc-help__section">
        <h2 class="bc-help__section-title">Administrator Guide</h2>
        
        <h3 class="bc-help__subsection-title">Setting a Default Template</h3>
        <ol class="bc-help__steps">
          <li>Navigate to Business Continuity → Templates</li>
          <li>Click on the template you want to set as default</li>
          <li>Check the "Set as Default Template" option</li>
          <li>Click "Save"</li>
          <li>The default template will be pre-selected when creating new plans</li>
        </ol>
        <p class="bc-help__note"><strong>Note:</strong> Only one template can be set as default at a time. Setting a new default will remove the flag from the previous default template.</p>
        
        <h3 class="bc-help__subsection-title">Bootstrapping the Default Template</h3>
        <p>To create the default government BCP template in your system:</p>
        <ol class="bc-help__steps">
          <li>As an admin, make a POST request to: <code>/api/bc/templates/bootstrap-default</code></li>
          <li>Or use the API documentation interface at <code>/docs</code></li>
          <li>The default template will be created with all standard sections</li>
          <li>The template includes comprehensive sections for government-standard BCPs</li>
        </ol>
        
        <h3 class="bc-help__subsection-title">Creating a Plan</h3>
        <p>As an administrator or editor, you can create new plans through either the web interface or API:</p>
        
        <h4 class="bc-help__minor-title">Via Web Interface:</h4>
        <ol class="bc-help__steps">
          <li>Go to Business Continuity → Plans</li>
          <li>Click "New Plan" button</li>
          <li>Fill in the plan details:
            <ul>
              <li>Title (e.g., "IT Disaster Recovery Plan")</li>
              <li>Plan Type (DR, IR, or BC)</li>
              <li>Template (select from available templates)</li>
              <li>Initial content (can be edited later)</li>
            </ul>
          </li>
          <li>Click "Create" to save</li>
          <li>The plan is created in "Draft" status</li>
        </ol>
        
        <h4 class="bc-help__minor-title">Via API:</h4>
        <pre class="bc-help__code">POST /api/bc/plans
Content-Type: application/json

{
  "title": "IT Disaster Recovery Plan",
  "status": "draft",
  "org_id": 1,
  "template_id": 1
}</pre>
        
        <h3 class="bc-help__subsection-title">Running the Approval Process</h3>
        <ol class="bc-help__steps">
          <li><strong>Prepare the Plan:</strong> Ensure the plan is complete and ready for review</li>
          <li><strong>Submit for Review:</strong>
            <ul>
              <li>Open the plan in edit mode</li>
              <li>Click "Submit for Review"</li>
              <li>Select one or more approvers from the user list</li>
              <li>Optionally add review notes</li>
              <li>Click "Submit"</li>
            </ul>
          </li>
          <li><strong>Notify Reviewers:</strong> Reviewers are automatically notified (if notification system is configured)</li>
          <li><strong>Review Process:</strong>
            <ul>
              <li>Reviewers access the plan and examine content</li>
              <li>Each reviewer independently approves or requests changes</li>
              <li>If changes are requested, plan returns to draft status</li>
              <li>Editor makes requested changes and resubmits</li>
            </ul>
          </li>
          <li><strong>Final Approval:</strong> When all reviewers approve, plan status automatically changes to "Approved"</li>
        </ol>
        
        <h3 class="bc-help__subsection-title">Managing Attachments</h3>
        <p>You can attach supporting documents to plans:</p>
        <ul class="bc-help__list">
          <li>Supported file types: PDF, DOCX, XLSX, PNG, JPG</li>
          <li>Maximum file size: 50 MB</li>
          <li>Files are automatically scanned for security (if antivirus is configured)</li>
          <li>Each attachment is tracked in the audit trail</li>
        </ul>
        
        <h3 class="bc-help__subsection-title">Monitoring Acknowledgments</h3>
        <ol class="bc-help__steps">
          <li>Open an approved plan</li>
          <li>Navigate to the "Acknowledgments" tab</li>
          <li>View statistics:
            <ul>
              <li>Total users who need to acknowledge</li>
              <li>Number who have acknowledged</li>
              <li>Number pending</li>
            </ul>
          </li>
          <li>Click "View Pending Users" to see who hasn't acknowledged</li>
          <li>Use "Send Reminders" to notify pending users</li>
        </ol>
      </section>

      <!-- Export Section -->
      <section id="export" class="bc-help__section">
        <h2 class="bc-help__section-title">Exporting Plans</h2>
        <p>BC plans can be exported to multiple formats for distribution, printing, or archival purposes.</p>
        
        <h3 class="bc-help__subsection-title">Export Formats</h3>
        <ul class="bc-help__list">
          <li><strong>PDF:</strong> Professional, print-ready format with government-standard styling</li>
          <li><strong>DOCX:</strong> Editable Microsoft Word format preserving structure and formatting</li>
        </ul>
        
        <h3 class="bc-help__subsection-title">How to Export</h3>
        <ol class="bc-help__steps">
          <li>Open the plan you want to export</li>
          <li>Click the "Export" button in the toolbar</li>
          <li>Select your preferred format (PDF or DOCX)</li>
          <li>Optionally select a specific version (defaults to current active version)</li>
          <li>Click "Generate Export"</li>
          <li>Download the generated file when ready</li>
        </ol>
        
        <h3 class="bc-help__subsection-title">Export Features</h3>
        <ul class="bc-help__list">
          <li>Includes complete plan content with all sections</li>
          <li>Embeds metadata (version, date, author)</li>
          <li>Preserves tables (BIA, risk assessments, contacts, vendors)</li>
          <li>Includes table of contents and section navigation</li>
          <li>Professional government-standard formatting</li>
        </ul>
        
        <h3 class="bc-help__subsection-title">Rate Limits</h3>
        <p>To prevent system abuse, exports are rate-limited:</p>
        <ul class="bc-help__list">
          <li>Default: 10 exports per minute per user</li>
          <li>Applies to both PDF and DOCX exports</li>
          <li>Rate limit can be configured by system administrators via <code>EXPORT_MAX_PER_MINUTE</code> setting</li>
          <li>If rate limit is exceeded, wait a minute before trying again</li>
        </ul>
        
        <h3 class="bc-help__subsection-title">PDF Configuration</h3>
        <p>Administrators can customize PDF rendering via the <code>WEASYPRINT_OPTIONS</code> environment variable:</p>
        <pre class="bc-help__code">WEASYPRINT_OPTIONS={"dpi": 96, "optimize_size": ["fonts"]}</pre>
        <p>Available options include:</p>
        <ul class="bc-help__list">
          <li><code>dpi</code>: Rendering resolution (default: 96)</li>
          <li><code>optimize_size</code>: Optimization features (e.g., ["fonts", "images"])</li>
        </ul>
      </section>

      <!-- Back to Top -->
      <div class="bc-help__footer">
        <a href="#" class="button button--secondary">Back to Top</a>
        <a href="/business-continuity/plans" class="button">Go to Plans</a>
      </div>
    </div>
  </div>
</div>

<style>
  .bc-help__toc {
    background: var(--color-surface-secondary);
    border-radius: var(--radius-md);
    padding: var(--spacing-4);
    margin-bottom: var(--spacing-6);
  }
  
  .bc-help__toc-list {
    list-style: none;
    padding: 0;
    margin: var(--spacing-2) 0 0 0;
  }
  
  .bc-help__toc-list li {
    margin: var(--spacing-1) 0;
  }
  
  .bc-help__toc-list a {
    color: var(--color-primary);
    text-decoration: none;
  }
  
  .bc-help__toc-list a:hover {
    text-decoration: underline;
  }
  
  .bc-help__section {
    margin-bottom: var(--spacing-8);
    padding-bottom: var(--spacing-6);
    border-bottom: 1px solid var(--color-border);
  }
  
  .bc-help__section:last-of-type {
    border-bottom: none;
  }
  
  .bc-help__section-title {
    font-size: var(--text-2xl);
    font-weight: var(--font-semibold);
    margin-bottom: var(--spacing-4);
    color: var(--color-text-primary);
  }
  
  .bc-help__subsection-title {
    font-size: var(--text-xl);
    font-weight: var(--font-medium);
    margin-top: var(--spacing-4);
    margin-bottom: var(--spacing-3);
    color: var(--color-text-primary);
  }
  
  .bc-help__minor-title {
    font-size: var(--text-lg);
    font-weight: var(--font-medium);
    margin-top: var(--spacing-3);
    margin-bottom: var(--spacing-2);
    color: var(--color-text-secondary);
  }
  
  .bc-help__list {
    margin: var(--spacing-3) 0;
    padding-left: var(--spacing-6);
  }
  
  .bc-help__list li {
    margin: var(--spacing-2) 0;
    line-height: 1.6;
  }
  
  .bc-help__steps {
    margin: var(--spacing-3) 0;
    padding-left: var(--spacing-6);
  }
  
  .bc-help__steps li {
    margin: var(--spacing-3) 0;
    line-height: 1.6;
  }
  
  .bc-help__steps ul {
    margin-top: var(--spacing-2);
    padding-left: var(--spacing-4);
  }
  
  .bc-help__roles {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-4);
    margin: var(--spacing-4) 0;
  }
  
  .bc-help__role-card {
    background: var(--color-surface-secondary);
    border-radius: var(--radius-md);
    padding: var(--spacing-4);
    border: 1px solid var(--color-border);
  }
  
  .bc-help__role-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    margin-bottom: var(--spacing-2);
    color: var(--color-primary);
  }
  
  .bc-help__role-description {
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-3);
  }
  
  .bc-help__role-permissions {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .bc-help__role-permissions li {
    padding: var(--spacing-1) 0;
    padding-left: var(--spacing-5);
    position: relative;
  }
  
  .bc-help__role-permissions li:before {
    content: "✓";
    position: absolute;
    left: 0;
    color: var(--color-success);
    font-weight: var(--font-semibold);
  }
  
  .bc-help__code {
    background: var(--color-surface-tertiary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: var(--spacing-3);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    overflow-x: auto;
    margin: var(--spacing-3) 0;
    display: block;
  }
  
  .bc-help__note {
    background: var(--color-info-bg);
    border-left: 4px solid var(--color-info);
    padding: var(--spacing-3);
    margin: var(--spacing-3) 0;
    border-radius: var(--radius-sm);
  }
  
  .bc-help__footer {
    display: flex;
    gap: var(--spacing-3);
    justify-content: center;
    margin-top: var(--spacing-6);
    padding-top: var(--spacing-6);
    border-top: 1px solid var(--color-border);
  }
  
  code {
    background: var(--color-surface-tertiary);
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-sm);
    font-family: var(--font-mono);
    font-size: 0.9em;
  }
</style>
{% endblock %}
