{% extends "base.html" %}

{% block sidebar_menu %}
  {{ super() }}
  <li class="menu__item">
    <a href="/shop">
      <span class="menu__icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false"><path d="M4 7h16l-1.5 12.5A2 2 0 0 1 16.52 21H7.48a2 2 0 0 1-1.98-1.5zM6 3h12a1 1 0 0 1 1 1v2H5V4a1 1 0 0 1 1-1z"/></svg>
      </span>
      <span class="menu__label">Shop</span>
    </a>
  </li>
  <li class="menu__item">
    <a href="/forms" aria-current="page">
      <span class="menu__icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false"><path d="M6 2h9l5 5v15H6a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1zm8 7h4.5L14 4.5V9z"/></svg>
      </span>
      <span class="menu__label">Forms</span>
    </a>
  </li>
  <li class="menu__item">
    <a href="/staff">
      <span class="menu__icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" focusable="false"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-3.31 0-8 1.66-8 5v1h16v-1c0-3.34-4.69-5-8-5z"/></svg>
      </span>
      <span class="menu__label">Staff</span>
    </a>
  </li>
{% endblock %}

{% block content %}
<div class="forms-layout">
  <section class="card card--panel forms-layout__menu">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Available forms</h2>
        <p class="card__subtitle">Launch OpnForm experiences without leaving the portal.</p>
      </div>
    </header>
    {% if forms %}
      <nav class="forms-menu" aria-label="Form selection">
        {% for form in forms %}
          <button
            type="button"
            class="forms-menu__button{% if loop.first %} is-active{% endif %}"
            data-form-switch
            data-form-url="{{ form.iframe_url }}"
          >
            <span class="forms-menu__name">{{ form.name }}</span>
            {% if form.description %}
              <span class="forms-menu__description">{{ form.description }}</span>
            {% endif %}
          </button>
        {% endfor %}
      </nav>
    {% else %}
      <p class="text-muted">No forms have been published yet.</p>
    {% endif %}
  </section>

  <section class="card card--panel forms-layout__viewer">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Form viewer</h2>
        <p class="card__subtitle">Selected forms open securely inside the portal with sandboxed permissions.</p>
      </div>
      {% if opnform_base_url %}
        <a class="button button--ghost" href="{{ opnform_base_url }}" target="_blank" rel="noopener">Open OpnForm</a>
      {% endif %}
    </header>
    {% if forms %}
      <iframe
        id="form-frame"
        class="form-frame"
        src="{{ forms[0].iframe_url }}"
        loading="lazy"
        title="Selected form"
        allow="publickey-credentials-get *; publickey-credentials-create *"
        referrerpolicy="strict-origin-when-cross-origin"
      ></iframe>
    {% else %}
      <div class="empty-state">
        <p>Select or create a form to begin.</p>
      </div>
    {% endif %}
  </section>
</div>

<script type="application/json" id="forms-data">{{ forms | tojson }}</script>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/forms.js" defer></script>
{% endblock %}
