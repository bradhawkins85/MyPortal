{% extends "base.html" %}

{% block content %}
<div class="forms-layout">
  <section class="card card--panel forms-layout__menu">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Available forms</h2>
        <p class="card__subtitle">Launch OpnForm experiences without leaving the portal.</p>
      </div>
    </header>
    {% if forms %}
      <nav class="forms-menu" aria-label="Form selection">
        {% for form in forms %}
          <button
            type="button"
            class="forms-menu__button{% if loop.first %} is-active{% endif %}"
            data-form-switch
            data-form-index="{{ loop.index0 }}"
            data-form-url="{{ form.iframe_url }}"
          >
            <span class="forms-menu__name">{{ form.name }}</span>
            {% if form.description %}
              <span class="forms-menu__description">{{ form.description }}</span>
            {% endif %}
          </button>
        {% endfor %}
      </nav>
    {% else %}
      <p class="text-muted">No forms have been published yet.</p>
    {% endif %}
  </section>

  <section class="card card--panel forms-layout__viewer">
    <header class="card__header card__header--stacked">
      <div>
        <h2 class="card__title">Form viewer</h2>
        <p class="card__subtitle">Selected forms open securely inside the portal with sandboxed permissions.</p>
      </div>
      {% if opnform_base_url %}
        <a class="button button--ghost" href="{{ opnform_base_url }}" target="_blank" rel="noopener">Open OpnForm</a>
      {% endif %}
    </header>
    {% if forms %}
      <div id="form-viewer" class="form-viewer" data-form-container>
        {% if forms[0].embed_html %}
          {{ forms[0].embed_html | safe }}
        {% else %}
          <iframe
            class="form-frame"
            src="{{ forms[0].iframe_url }}"
            loading="lazy"
            title="Selected form"
            allow="publickey-credentials-get *; publickey-credentials-create *"
            referrerpolicy="strict-origin-when-cross-origin"
          ></iframe>
        {% endif %}
      </div>
    {% else %}
      <div class="empty-state">
        <p>Select or create a form to begin.</p>
      </div>
    {% endif %}
  </section>
</div>

<script type="application/json" id="forms-data">{{ forms | tojson }}</script>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/forms.js" defer></script>
{% endblock %}
