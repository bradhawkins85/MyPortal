{% extends "base.html" %}

{% set scope_labels = {
  "anonymous": "Public",
  "user": "Specific users",
  "company": "Company members",
  "company_admin": "Company admins",
  "super_admin": "Super admins"
} %}

{% block title %}{{ kb_article.title }} Â· Knowledge base{% endblock %}

{% block header_title %}
  <span class="header__title-text">{{ kb_article.title }}</span>
{% endblock %}

{% block sidebar_menu %}
  {% if has_authenticated_user %}
    {{ super() }}
  {% else %}
    <li class="menu__item">
      <a href="/login">
        <span class="menu__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false"><path d="M10 4h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H10a1 1 0 0 1-1-1v-3h2v2h8V6h-8v2H9V5a1 1 0 0 1 1-1zm-1.707 7.293 2.586-2.586L12.293 10.12 10.414 12l1.879 1.879-1.414 1.414-2.586-2.586a1 1 0 0 1 0-1.414z"/></svg>
        </span>
        <span class="menu__label">Sign in</span>
      </a>
    </li>
    <li class="menu__item">
      <a href="/knowledge-base">
        <span class="menu__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false"><path d="M6 3a3 3 0 0 1 3-3h9a2 2 0 0 1 2 2v19.5a.5.5 0 0 1-.74.44L15 20l-4.26 1.94A.5.5 0 0 1 10 21.5V5a1 1 0 0 0-1-1H6v15.5a.5.5 0 0 1-.74.44L3 19.94V4a1 1 0 0 1 1-1z"/></svg>
        </span>
        <span class="menu__label">Knowledge base</span>
      </a>
    </li>
  {% endif %}
{% endblock %}

{% block header_actions %}
  <form id="knowledge-base-search-form" class="header-search" data-knowledge-base-search>
    <label for="knowledge-base-search" class="visually-hidden">Search knowledge base</label>
    <input
      type="search"
      id="knowledge-base-search"
      name="query"
      class="input input--compact"
      placeholder="Search knowledge base"
      autocomplete="off"
      required
    />
    <button type="submit" class="button button--ghost">Search</button>
  </form>
  {% if kb_is_super_admin %}
    <a class="button button--ghost" href="/admin/knowledge-base">Knowledge base admin</a>
  {% endif %}
{% endblock %}

{% block content %}
<div class="knowledge-base knowledge-base--article">
  <article class="card card--panel knowledge-base__article" data-knowledge-base-article>
    <header class="card__header card__header--stacked">
      <div>
        <h1 class="card__title">{{ kb_article.title }}</h1>
        {% if kb_article.summary %}
          <p class="card__subtitle">{{ kb_article.summary }}</p>
        {% endif %}
      </div>
      <div class="knowledge-base__tags">
        <span class="tag tag--muted">{{ scope_labels.get(kb_article.permission_scope, kb_article.permission_scope|title) }}</span>
        {% if not kb_article.is_published %}
          <span class="tag tag--warning">Draft</span>
        {% endif %}
      </div>
    </header>
    <div class="card__body knowledge-base__body" data-knowledge-base-article-body>
      {% if kb_article.sections %}
        {% for section in kb_article.sections %}
          <section class="knowledge-base__section" data-knowledge-base-section>
            {% if section.heading %}
              <h2 class="knowledge-base__section-heading">{{ section.heading }}</h2>
            {% endif %}
            <div class="knowledge-base__section-content">
              {{ section.content | safe }}
            </div>
          </section>
        {% endfor %}
      {% else %}
        {{ kb_article.content | safe }}
      {% endif %}
    </div>
  </article>
</div>
{% endblock %}

{% block scripts %}
  <script src="{{ static_url(\'/static/js/knowledge_base.js\') }}" defer></script>
{% endblock %}
